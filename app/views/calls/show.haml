.centered-content.column
  .title
    -if @page.viewing_todays_call?
      Today's Call:
    - else
      Call on:
    = DateFormatter.month_day_time(@page.call.scheduled_on)

  .timer-page
    .timer-details
      - if @page.timer.nil?
        .timer-name
          No timer started yet

      - if @page.timer.present?
        .timer-name
          Time left for
          = @page.timer.user.first_plus_initial

        .timer-container
          .timer{data: {timer_end: @page.timer.ends_at_for_js}}
            = @page.timer.created_at

      - if @page.viewer_is_facilitator?(current_user)
        .timer-controls
          .title New Timer
          = form_for Timer.new, url: call_timer_path(@page.call, @page.timer) do |form|
            .form-field
              = form.label :duration
              = form.select :duration, options_for_select(Timer.duration_select_options)
            .form-field
              = form.label :user_id
              = form.select :user_id, options_for_select(@page.group.user_select_options)
            = form.submit

    %audio#timer_alert{src: "http://static1.grsites.com/archive/sounds/musical/musical009.mp3", controls: false}


  -if @page.last_weeks_call
    = render 'commitments',
      title:"Last Week's Commitments",
      commitments: @page.last_weeks_call.commitments,
      empty_message: "There were no commitments for the last call",
      show_completed: true

  - if @page.viewing_todays_call?
    = render 'commitments',
      title:"This week we're committing to...",
      commitments: @page.next_call.commitments,
      empty_message: "No one has added any commitments yet",
      show_completed: false

    - unless @page.viewer_added_commitment?(current_user)
      .form#commitment_form
        .title Add your commitment for the coming week
        = form_with model: [@page.next_call, Commitment.new] do |form|
          .form-field
            = form.text_field :body
          = form.submit

  %h2 Notes
  .primary-list#notes_container{data: {call_id: @page.call.id}}
    - @page.notes.each do |note|
      .list-item
        = note.author.full_name
        = note.body

  .form#note_form
    .title Add a note
    = form_with model: [@page.call, Note.new], url: call_note_path(@page.call) do |form|
      .form-field
        = form.text_area :body
      = form.submit
